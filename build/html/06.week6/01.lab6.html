<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>7.1. Lab 06 DB Management: Backup, Replicate, &amp; Update &mdash; ist5001 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=cd5dafa7" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="8. Week 7" href="../07.week7/week7.html" />
    <link rel="prev" title="7. Week 6" href="week6.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            ist5001
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../00.week0/week0.html">1. week 0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01.week1/week1.html">2. Week 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02.week2/week2.html">3. Week 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03.week3/week3.html">4. Week 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04.week4/week4.html">5. Week 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05.week5/week5.html">6. Week 5</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="week6.html">7. Week 6</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">7.1. Lab 06 DB Management: Backup, Replicate, &amp; Update</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#part-0-introduction">7.1.1. Part 0. Introduction</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../07.week7/week7.html">8. Week 7</a></li>
<li class="toctree-l1"><a class="reference internal" href="../08.appendix/appendix.html">9. Appendix</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ist5001</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="week6.html"><span class="section-number">7. </span>Week 6</a></li>
      <li class="breadcrumb-item active"><span class="section-number">7.1. </span>Lab 06 DB Management: Backup, Replicate, &amp; Update</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/06.week6/01.lab6.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="lab-06-db-management-backup-replicate-update">
<h1><span class="section-number">7.1. </span>Lab 06 DB Management: Backup, Replicate, &amp; Update<a class="headerlink" href="#lab-06-db-management-backup-replicate-update" title="Link to this heading"></a></h1>
<div class="admonition-assignment-instruction admonition">
<p class="admonition-title">Assignment Instruction</p>
<p>To successfully complete this assignment, you are advised to pay attention to the following:</p>
<ol class="arabic simple">
<li><p><strong>Follow instructions:</strong> Read, interpret, and follow instructions very carefully. Finish reading the whole question and note the requirements before you start working on the question.</p></li>
<li><p><strong>Use resources:</strong> You may use any resources available to you via the web. You are encouraged to discuss the problems with others before you sit down and attempt to answer the questions.</p></li>
<li><p><strong>Work independently:</strong> While you are completing the questions, you are expected to work on your own without direct help from other people (non-human resources such as search engines are still allowed).</p></li>
<li><p><strong>Work together:</strong> Come to the office hours to work as a group on the interpretation of and solutions to questions. When using text messaging, attach screenshots.</p></li>
<li><p><strong>For introduction to basic Linux and shell commands and special characters, see:</strong>
- <a class="reference external" href="https://bashnet.org/docs/linux_shell_commands.php">Linux &amp; shell basic commands</a>
- <a class="reference external" href="https://bashnet.org/docs/linux_special_characters.php">Linux &amp; shell special characters</a></p></li>
</ol>
</div>
<div class="admonition-getting-started admonition">
<p class="admonition-title">Getting Started</p>
<ol class="arabic simple">
<li><p><strong>class directory:</strong> To begin this assignment, make sure you navigate into the class directory under your user home directory.</p></li>
<li><p><strong>scp the tar file:</strong> Use <cite>scp</cite> to copy the tar file <cite>a06.tar.gz</cite> from <cite>datacenter&#64;tychen.us</cite> to your <cite>~/class</cite> directory. The command is: <cite>scp datacenter&#64;tychen.us:~/class/labs/a06.tar.gz .</cite> (### don’t forget the “ . ” at the end of the command) and the password is “InCharge56!”</p></li>
<li><p><strong>unzip the tar file:</strong> Extract the contents of the tar file: <cite>tar -xf a06.tar.gz</cite>. Once the files are extracted, you should see the <cite>a06</cite> folder (a directory containing several directories and files) in your class directory. These are the files you need to complete this assignment.</p></li>
<li><p><strong>a06:</strong> Unless otherwise specified in the question, all file names are given relative to the directory <cite>~/class/a06</cite>.</p></li>
<li><p><strong>Passwords:</strong> All the account names and the corresponding passwords are recorded in Canvas Assignment <cite>a00</cite>, where you keep them updated.</p></li>
</ol>
</div>
<div class="admonition-when-you-are-done admonition">
<p class="admonition-title">When You Are Done</p>
<p>When you have completed the assignment:</p>
<ol class="arabic simple">
<li><p><strong>done.sh:</strong> Run the script <cite>done.sh</cite> in <cite>~/class</cite> as follows:
<cite>./done.sh firstname lastname a06</cite> (The <cite>done.sh</cite> script is part of Assignment <cite>h01</cite>.)</p></li>
<li><p><strong>lab06.txt:</strong> The <cite>done.sh</cite> script will check your answers and create a new .txt called <cite>lab06.txt</cite> in the <cite>a06</cite> directory that you will need to submit to Canvas for assignment <cite>a06</cite>.</p></li>
<li><p><strong>Download lab06.txt to submit to Canvas:</strong> From your local computer terminal (cmd or PowerShell for Windows and Terminal for macOS), change into a folder (e.g., <cite>cd Documents</cite> to go into your Documents folder). Use the <cite>scp</cite> command to copy your submission file from your VM to your local computer’s Documents folder:
<cite>scp YOUR_USERNAME&#64;YOUR_VM_IP_ADDRESS:~/class/a06/lab06.txt .</cite></p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can run the <cite>done.sh</cite> script at any point when you are working on the assignment and the content of the generated <cite>lab06.txt</cite> may be helpful in addition to the check scripts in each question. However, you must run it just prior to submitting the generated <cite>lab06.txt</cite> file in your <cite>class/a06</cite> directory to Canvas to make sure you are submitting the most recent file.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To see your VM’s IP address, run <cite>ip addr</cite> or <cite>ifconfig</cite> (installation of netools required).</p>
</div>
</div>
<section id="part-0-introduction">
<h2><span class="section-number">7.1.1. </span>Part 0. Introduction<a class="headerlink" href="#part-0-introduction" title="Link to this heading"></a></h2>
<div class="admonition-introduction admonition">
<p class="admonition-title">Introduction</p>
<p>This activity introduces you to the concepts and challenges of testing your information system. One of the most critical requirements of an information system is that it be reliable. Reliability means many things, but it includes predictable functionality, accurate information, and long-term availability. This lab will introduce you to:</p>
<ul class="simple">
<li><p>Establish baseline information of the database</p></li>
<li><p>Replicate the database</p></li>
<li><p>Database recovery processes and procedures</p></li>
<li><p>System design and reliability</p></li>
<li><p>Quality assurance testing</p></li>
</ul>
<p>One of the key requirements of any information system and database is that the system be reliable. Complex information systems have many ways in which they can fail and a system that doesn’t work in a predictable and useful manner is nearly useless, if not worse. This lab touches on several aspects of the challenge of changing an information system while it remains functional and reliable:</p>
<ul class="simple">
<li><p>Is the system accessible during the transition, or does it need to be taken offline for all or part of the upgrade?</p></li>
<li><p>Does the system function as required?</p></li>
<li><p>Is the information provided accurate?</p></li>
<li><p>Is the information secure (available over time, stable over time, accessible over time)?</p></li>
</ul>
<p>These requirements of an information system or a database may result in using one or many different tools and techniques to achieve. In this activity, we will use</p>
<ul class="simple">
<li><p>mysql backup tools,</p></li>
<li><p>mysql scripts, and</p></li>
<li><p>design some processes</p></li>
</ul>
<p>MAKE SURE YOU USE THE SUGGESTED FILENAMES AND ACCOUNTS FOR THIS ASSIGNMENT.</p>
<p>In this assignment, our task is to add 2016 sales data to our existing car sales database. What is different about this data from the data we used for 2010-2015 is that it also includes data for two new dealerships. Our goal is to add this new data to our existing database without compromising the 2010 to 2015 data. To accomplish this, we need to:</p>
<ol class="arabic simple">
<li><p>Ensure that we can roll back to the original version of the data if we make a mistake, and</p></li>
<li><p>Determine if any changes we make have impacted our 2010-2015 data.</p></li>
</ol>
<p>Before you proceed, note that the following SQL commands will be handy and you should use them to explore your database:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">USER(</span> <span class="pre">);</span></code> - to show the current active account in MySQL.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">DATABASE(</span> <span class="pre">);</span></code> - to see the current DB used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">DATABASES;</span></code> - to show all the databases.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">TABLES;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DESCRIBE</span> <span class="pre">tbl_name;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span> <span class="pre">FROM</span> <span class="pre">tbl_name</span> <span class="pre">LIMIT</span> <span class="pre">n;</span></code> - see <cite>n</cite> rows of the data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SHOW</span> <span class="pre">GRANTS</span> <span class="pre">FOR</span> <span class="pre">user_name;</span></code> - show granted privileges for <cite>user_name</cite>.</p></li>
</ul>
</div>
<div class="admonition-part-1-establishing-baseline-tests admonition">
<p class="admonition-title">Part 1. Establishing Baseline Tests</p>
<div class="admonition-requirements admonition">
<p class="admonition-title">1.1. Requirements</p>
<p>Create a comprehensive series of data summary queries as a mysql script file (call this file sales_v1.sql). You will need to run the mysql command with this script as the input file prior to moving to the later parts of this assignments. This will provide you with the baseline data so that you can ensure that your database is updated properly. You will need this SQL script for the later steps below and to give you the answers you need in the a01.txt. This SQL script should give you the following baseline information about the dataset:</p>
<ul class="simple">
<li><p>The number of agents (# DESCRIBE tbl_name to decide which field to use for SELECT)</p></li>
<li><p>The number of owners</p></li>
<li><p>The number of dealerships</p></li>
<li><p>The number of new cars sold each year 2010 to 2015</p></li>
<li><p>The number of used cars sold each year 2010 to 2015</p></li>
</ul>
</div>
<div class="admonition-generate-query-results admonition">
<p class="admonition-title">1.2. Generate query results</p>
<p>Once you have completed the script, run mysql from the command line with your queries and save the output to a file using a command like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mysql<span class="w"> </span>-u<span class="w"> </span>salesadmin<span class="w"> </span>–p<span class="w"> </span>&lt;<span class="w"> </span>sales_v1.sql<span class="w"> </span>&gt;<span class="w"> </span>sales_v1.txt
</pre></div>
</div>
<p>After running this command, make sure you have the answers to these questions for each of the years stored in the sales_v1.txt file before you proceed to the next step.</p>
<p>When you have finished this part, enter DONE in part A of a01.txt and answer the following questions in parts B through F. You may want to nano a01.txt in one terminal and sales_v1.txt in another.</p>
<p>Enter DONE when you have completed this part.</p>
<ul class="simple">
<li><p>How many agents are in the sales database?</p></li>
<li><p>How many owners are in the sales database?</p></li>
<li><p>How many dealers are in the sales database?</p></li>
<li><p>How many new cars were sold in 2012?</p></li>
<li><p>How many used cars were sold in 2013?</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By now you should have learned it is a good practice to open the nano editor in one terminal and mysql in another and tile them side by side. In the nano editor, you design your algorithm (code blocks) and build code step by step, while exploring the dataset, testing and debugging your queries in the mysql window as salesadmin at the same time. When you have a working query, you then copy and paste it back into the nano editor window.</p>
<p>There is no easy way of doing loops in MySQL without using a stored procedure. In this question, just prepare each statement for the year as separate queries.</p>
<p>Don’t forget to include the USE DATABASE line whenever you need to run queries against a database.</p>
</div>
</div>
</div>
<div class="admonition-part-2-replicating-databases-mysqldump admonition">
<p class="admonition-title">Part 2. Replicating Databases (mysqldump)</p>
<p>Our next step is to replicate the sales database and tables it contains. The steps below replicate an existing database within mysql. Replication is useful in many cases including, for example, separating databases for development and production.</p>
<div class="admonition-create-the-db admonition">
<p class="admonition-title">2.1. Create the DB</p>
<p>Run mysql as root and create a new database. In this case we will call the new database dev (development). We will also need to give it the appropriate permissions. The procedure should be as follows (note: this is a good opportunity to practice HereDoc if you are running the SQL statements as a .sql file):</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">DROP</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">dev</span><span class="p">;</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">dev</span><span class="p">;</span><span class="w"> </span><span class="c1">-- (dev == development)</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">dev</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">salesadmin</span><span class="o">@</span><span class="n">localhost</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">dev</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">salesmgr</span><span class="o">@</span><span class="n">localhost</span><span class="p">;</span>
<span class="n">quit</span><span class="p">;</span><span class="w"> </span><span class="c1">-- (disregard this line if you are not logged in to run the queries)</span>
</pre></div>
</div>
<p>After creating the dev database you should make sure the database is created and empty.</p>
<p>After you have the dev database created, your next step is to create a file called env_mysql that defines 2 environment variable MYSQLU and MYSQLP as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">MYSQLU</span><span class="o">=</span><span class="s1">&#39;salesadmin&#39;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">MYSQLP</span><span class="o">=</span><span class="s1">&#39;whatever_your_password_is&#39;</span>
printenv<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>MYSQL<span class="w"> </span><span class="c1">### checking environment variables</span>
</pre></div>
</div>
<p>Run the env_mysql file to make the MYSQL user account and password available in the command line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>env_mysql
</pre></div>
</div>
</div>
<div class="admonition-replicate-the-database admonition">
<p class="admonition-title">2.2. Replicate the database</p>
<p>Next, run the following command from the Unix command line to replicate the tables from the sales database to the dev database.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mysqldump<span class="w"> </span>--no-tablespaces<span class="w"> </span>-y<span class="w"> </span>-u<span class="w"> </span><span class="nv">$MYSQLU</span><span class="w"> </span>-p<span class="nv">$MYSQLP</span><span class="w"> </span>sales<span class="w"> </span><span class="p">|</span><span class="w"> </span>mysql<span class="w"> </span>-u<span class="w"> </span><span class="nv">$MYSQLU</span><span class="w"> </span>-p<span class="nv">$MYSQLP</span><span class="w"> </span>dev<span class="w"> </span><span class="o">(</span><span class="c1"># give it ~25 seconds to a minute to replicate)</span>
</pre></div>
</div>
<p>You may see CLI password warnings because you have supplied them in command line. You may also see a mysqldump “Access denied” error (this happens when you use salesadmin instead of the root account), which should be harmless in this case.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>chen_user@vma50:~/class/a06/q02$ mysqldump -u $MYSQLU -p$MYSQLP sales | mysql -u -u $MYSQLU -p$MYSQLP dev
mysqldump: [Warning] Using a password on the command line interface can be insecure.
mysql: [Warning] Using a password on the command line interface can be insecure.
mysqldump: Error: &#39;Access denied; you need (at least one of) the PROCESS privilege(s) for this operation&#39; when trying to dump tablespaces
chen_user@vma50:~/class/a06/q02$
</pre></div>
</div>
<p>If you see a very long MySQL message as below, you may have issued an incorrect password.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>...
...
...
max-allowed-packet                16777216
net-buffer-length                 16384
select-limit                      1000
max-join-size                     1000000
secure-auth                       TRUE
show-warnings                     FALSE
plugin-dir                        (No default value)
default-auth                      (No default value)
binary-mode                       FALSE
connect-expired-password          FALSE
[Warning] Using a password on the command line interface can be insecure.
mysqldump: Error: &#39;Access denied; you need (at least one of) the PROCESS privilege(s) for this operation&#39; when trying to dump tablespaces
mysqldump: Got errno 32 on write
</pre></div>
</div>
</div>
<div class="admonition-check-your-work admonition">
<p class="admonition-title">2.3. Check your work</p>
<p>After replicating the sales database to dev, we want to make sure the tables are successfully replicated to the dev database.</p>
<p>Use the following commands to perform a quality check for this database replication:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">DATABASE</span><span class="p">();</span><span class="w"> </span><span class="o">#</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">it</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">dev</span><span class="p">,</span><span class="w"> </span><span class="n">issue</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">USE</span><span class="w"> </span><span class="n">command</span><span class="p">.</span>
<span class="n">USE</span><span class="w"> </span><span class="n">dev</span><span class="p">;</span>
<span class="k">SHOW</span><span class="w"> </span><span class="n">GRANTS</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="n">salesadmin</span><span class="o">@</span><span class="n">localhost</span><span class="p">;</span>
<span class="k">SHOW</span><span class="w"> </span><span class="n">TABLES</span><span class="p">;</span>
<span class="k">DESCRIBE</span><span class="w"> </span><span class="n">tbl_name</span><span class="p">;</span>
<span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tbl_name</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tbl_name</span><span class="p">;</span><span class="w"> </span><span class="p">(</span><span class="o">#</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">check</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">tables</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">replicated</span><span class="w"> </span><span class="n">correctly</span><span class="w"> </span><span class="c1">-- at least the total numbers.)</span>
</pre></div>
</div>
<p>When you have finished Part 2, enter DONE in part A of a02.txt.
Run ./check02.sh.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>### Workaround for access denied error ### If you run into privilege issues (“1045: Access denied for user…”), you have supplied an incorrect password. Check to correct it or use the root account to replicate the tables over to dev:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mysqldump<span class="w"> </span>-u<span class="w"> </span>root<span class="w"> </span>-p<span class="w"> </span>sales<span class="w"> </span><span class="p">|</span><span class="w"> </span>mysql<span class="w"> </span>-u<span class="w"> </span>root<span class="w"> </span>–p<span class="w"> </span>dev<span class="p">;</span>
</pre></div>
</div>
<p>and then, as root, grant privileges to salesadmin:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">GRANT</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">dev</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="o">`</span><span class="n">salesadmin</span><span class="o">`@`</span><span class="n">localhost</span><span class="o">`</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">dev</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="o">`</span><span class="n">salesmgr</span><span class="o">`@`</span><span class="n">localhost</span><span class="o">`</span><span class="p">;</span>
</pre></div>
</div>
<p>To eliminate the error message “‘Access denied; you need (at least one of) the PROCESS privilege(s) for this operation’ when trying to dump tablespaces”, you may try add the –no-tablespaces option when running mysqldump.</p>
</div>
</div>
</div>
<div class="admonition-part-3-backing-up-databases-mysqldump admonition">
<p class="admonition-title">Part 3. Backing Up Databases (mysqldump)</p>
<p>Our next step is to create a backup of our two databases as files just in case of mysql database corruption. While this is usually not likely, in risk management we are prepared for the worst. Also, backup is part of the daily practice for system and database administrators.</p>
<div class="admonition-create-the-backup admonition">
<p class="admonition-title">3.1. Create the backup</p>
<p>Create the necessary backup files from the Linux CLI using the following two commands (you may want to create a link to and source the env_mysql file in q02 first):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mysqldump<span class="w"> </span>-u<span class="w"> </span><span class="nv">$MYSQLU</span><span class="w"> </span>-p<span class="nv">$MYSQLP</span><span class="w"> </span>sales<span class="w"> </span>&gt;<span class="w"> </span>bck_sales_v3.sql
mysqldump<span class="w"> </span>-u<span class="w"> </span><span class="nv">$MYSQLU</span><span class="w"> </span>-p<span class="nv">$MYSQLP</span><span class="w"> </span>dev<span class="w"> </span>&gt;<span class="w"> </span>bck_dev_v3.sql
</pre></div>
</div>
<p>You may see the mysqldump password warning and Access denied error as below when issuing the mysqldump commands. These messages should be harmless.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>chen_user@vma50:~/class/a06/q03$ mysqldump -u $MYSQLU -p$MYSQLP sales &gt; bck_sales_v3.sql
mysqldump: [Warning] Using a password on the command line interface can be insecure.
mysqldump: Error: &#39;Access denied; you need (at least one of) the PROCESS privilege(s) for this operation&#39; when trying to dump tablespaces
chen_user@vma50:~/class/a06/q03$
</pre></div>
</div>
<p>The results should look similar to the example below. Note the difference in size between the two backup .sql files:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>chen_user@vma50:~/class/a06/q03$ ls -l
total 86232
-r--r--r-- 1 chen_user chen_user      314 Oct 23  2019 a03.bak
-rw-rw-r-- 1 chen_user chen_user      314 Oct 23  2019 a03.txt
-rw-rw-r-- 1 chen_user chen_user 44139009 Mar 20 16:02 bck_dev_v3.sql
-rw-rw-r-- 1 chen_user chen_user 44139011 Mar 20 15:58 bck_sales_v3.sql
-rwxrwxr-x 1 chen_user chen_user     4912 Jan  4  2018 check03.sh
lrwxrwxrwx 1 chen_user chen_user       16 Mar 20 15:57 env_mysql -&gt; ../q02/env_mysql
chen_user@vma50:~/class/a06/q03$
</pre></div>
</div>
</div>
<div class="admonition-diff-tar-and-mv admonition">
<p class="admonition-title">3.2. diff, tar, and mv</p>
<p>Compare both .sql backup files by using the diff command to make sure they are identical except for database name and time of modification.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>chen_user@vma50:~/class/a06/q03$ diff bck_dev_v3.sql bck_sales_v3.sql
3c3
&lt; -- Host: localhost    Database: dev
---
&gt; -- Host: localhost    Database: sales
363c363
&lt; -- Dump completed on 2021-03-20 16:02:12
---
&gt; -- Dump completed on 2021-03-20 15:58:22
chen_user@vma50:~/class/a06/q03$
</pre></div>
</div>
<p>The .sql backup files now reside in your current directory. We want to compress both files to .gz files and mv them to your ~/backup directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tar<span class="w"> </span>-czvf<span class="w"> </span>file_name.gz<span class="w"> </span>file_name<span class="w"> </span><span class="o">(</span><span class="c1">### see URL for explanation on tar or just google for it for more information)</span>
ls<span class="w"> </span>-lt<span class="w"> </span><span class="o">(</span><span class="c1">### to make sure the archives exists and are created timely as follows.)</span>
<span class="w">       </span>-rw-rw-r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>chen_user<span class="w"> </span>chen_user<span class="w"> </span><span class="m">44139011</span><span class="w"> </span>Jul<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">17</span>:38<span class="w"> </span>bck_dev_v3.sql
<span class="w">       </span>-rw-rw-r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>chen_user<span class="w"> </span>chen_user<span class="w">  </span><span class="m">9360012</span><span class="w"> </span>Jul<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">17</span>:47<span class="w"> </span>bck_dev_v3.sql.gz
<span class="w">       </span>-rw-rw-r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>chen_user<span class="w"> </span>chen_user<span class="w"> </span><span class="m">44139013</span><span class="w"> </span>Jul<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">17</span>:37<span class="w"> </span>bck_sales_v3.sql
<span class="w">       </span>-rw-rw-r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>chen_user<span class="w"> </span>chen_user<span class="w">  </span><span class="m">9360015</span><span class="w"> </span>Jul<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">17</span>:48<span class="w"> </span>bck_sales_v3.sql.gz
mv<span class="w"> </span><span class="o">(</span><span class="c1">### move both backup (.gz) files to ~/backup directory. You may use wild card (mv *gz) to move them in one line of command)</span>
ls<span class="w"> </span>~/backup<span class="w"> </span><span class="o">(</span><span class="c1">### to make sure the tar.gz files are in the right place)</span>
</pre></div>
</div>
<p>Hopefully, the backup files won’t ever be needed, but many people are paid to constantly create and manage them for risk management purposes.</p>
</div>
<div class="admonition-verify-dbs admonition">
<p class="admonition-title">3.3. Verify DBs</p>
<p>We want to run the same set of queries on the original sales DB and the new dev DB to verify that the dev and sales databases are the same.</p>
<p>Copy: A good way to do this is to use a slightly modified version of your database query script you created in Part 1, sales_v1.sql, to query the dev (development) database rather than the sales database.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cp<span class="w"> </span>../q01/sales_v1.sql<span class="w"> </span>dev_v3.sql<span class="w"> </span><span class="o">(</span><span class="c1"># or cp and then mv to rename)</span>
</pre></div>
</div>
<p>Modify: use nano to edit dev_v3.sql (the database you USE needs to be changed)
change the name of the DB from sales to dev
Note: In both sales_v1.sql and dev_v3.sql, use lower case for the USE in first line of the .sql file; check code issue.)</p>
<p>Query and output: Run the following command to get an output file with the same queries as in q01:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mysql<span class="w"> </span>–u<span class="w"> </span>salesadmin<span class="w"> </span>–p<span class="w"> </span>&lt;<span class="w"> </span>dev_v3.sql<span class="w"> </span>&gt;<span class="w"> </span>dev_v3.txt
</pre></div>
</div>
<p>diff to compare: Since you are doing this with a reproducible script you can use the diff command to compare the different databases quickly and automatically as follows.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>diff<span class="w"> </span>../q01/sales_v1.txt<span class="w"> </span>dev_v3.txt<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc
</pre></div>
</div>
<p>You should see no differences (i.e., a wc output of “0 0 0”) with NO other warning or error messages.</p>
</div>
<div class="admonition-check-your-work admonition">
<p class="admonition-title">3.4. Check your work</p>
<p>Two terminals: Tile two terminals nicely alongside this instruction to answer the following questions.</p>
<p>When you have finished this part, enter DONE in part A of a03.txt and answer the following questions in parts B through G.</p>
<p>Enter DONE when you have completed this part.</p>
<ul class="simple">
<li><p>How many agents are in the dev database?</p></li>
<li><p>How many owners are in the dev database?</p></li>
<li><p>How many dealers are in the dev database?</p></li>
<li><p>How many new cars were sold in 2012 according to the dev database?</p></li>
<li><p>How many used cars were sold in 2013 according to the dev database?</p></li>
<li><p>Do these results match the answers you got for part 1? (yes or no)</p></li>
</ul>
<p>Check03.sh: Running check03.sh will determine if the required files have been created, that the change to the scripts have been made and that the output files match as expected.</p>
</div>
</div>
<div class="admonition-part-4-update-the-development-database admonition">
<p class="admonition-title">Part 4. Update the Development Database</p>
<div class="admonition-create-sql-files-and-insert-data admonition">
<p class="admonition-title">4.1. Create .sql files and insert data</p>
<p>The q04 directory contains a bash script named insert.sh. You will use this script to insert the data into the dev database. The script insert.sh requires two parameters:
The database you want to update and
The sales year to add (in this case, 2016).</p>
<p>For example, you will run the script insert.sh as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./insert.sh<span class="w"> </span>dev<span class="w"> </span><span class="m">2016</span>
</pre></div>
</div>
<p>This insert.sh script will create a file called update_dev2016.sql, which you will need to run using the mysql command to insert the 2016 sales data. Take a look at the content of update_dev2016.sql and you should note that this .sql file will insert new data into 4 tables:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">create</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="n">dev</span><span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="n">dev</span><span class="p">;</span>
<span class="k">source</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">agents</span><span class="p">.</span><span class="k">sql</span>
<span class="k">source</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">dealers</span><span class="p">.</span><span class="k">sql</span>
<span class="k">source</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">owners</span><span class="p">.</span><span class="k">sql</span>
<span class="k">source</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">sales_2016</span><span class="p">.</span><span class="k">sql</span>
</pre></div>
</div>
<p>Your ./insert.sh will give you a suggestion of command similar to the following for sales data insertion. Use the environment variables you created in q02 or simply use the salesadmin username and password:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mysql<span class="w"> </span>-u<span class="w"> </span><span class="nv">$MYSQL_USER</span><span class="w"> </span>-p<span class="nv">$MYSQL_PASS</span><span class="w"> </span>&lt;<span class="w"> </span>update_dev2016.sql<span class="w"> </span><span class="p">&amp;</span>
<span class="o">(</span><span class="c1"># remember &amp;? It keeps the command running in the background and you can enter to move on the your next step)</span>
</pre></div>
</div>
<p>The update will take a while (may vary from 15 to 30 minutes). So, you may run a SQL query against the table to monitor the progress of data insertion:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mysql<span class="w"> </span>-u<span class="w"> </span><span class="nv">$MYSQLU</span><span class="w"> </span>-p<span class="nv">$MYSQLP</span><span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="s1">&#39;USE dev; SELECT COUNT(*) FROM sales_2016;&#39;</span><span class="w"> </span><span class="c1">## use Here String</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mysql<span class="w"> </span>-u<span class="w"> </span><span class="nv">$MYSQLU</span><span class="w"> </span>-p<span class="nv">$MYSQLP</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;USE dev; SELECT COUNT(*) FROM sales_2016;&#39;</span><span class="w"> </span><span class="c1">## use -e (execute)</span>
</pre></div>
</div>
<p>or, get into the SQL CLI,</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">USE</span><span class="w"> </span><span class="n">db_name</span><span class="p">;</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sales_2016</span><span class="p">;</span>
</pre></div>
</div>
<p>Also, use the following Unix command to check the mysql progress:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>top<span class="w"> </span><span class="o">(</span><span class="c1"># you will see mysql at the top of the list of processes running with much of the CPU and MEM consumed by it. You can q or Ctl+c to exit top.)</span>
</pre></div>
</div>
</div>
<div class="admonition-verify admonition">
<p class="admonition-title">4.2. Verify</p>
<p>We want to verify that the changes made to the dev database are correct by creating an SQL file (q04.sql) to check the following (A good way to do this is to copy the ../q03/dev_v3.sql script you created for question 3 to a script called dev_v4.sql):
- The number of dealerships
- The number of agents
- The number of owners
- The number of new and used cars sold from 2010 to 2016 by all dealerships.</p>
<p>Modify dev_v4.sql so that it ALSO queries the data from 2016.</p>
<p>Use dev_v4.sql as input to mysql – again give the output a unique name such as dev_v4.txt. This can be done similarly as follows: (but of course you know when sales_2016 is updating the count would be inaccurate.)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mysql<span class="w"> </span>–u<span class="w"> </span><span class="nv">$MYSQLU</span><span class="w"> </span>–p<span class="nv">$MYSQLP</span><span class="w"> </span>&lt;<span class="w"> </span>dev_v4.sql<span class="w"> </span>&gt;<span class="w"> </span>dev_v4.txt
</pre></div>
</div>
</div>
<div class="admonition-check-your-work admonition">
<p class="admonition-title">4.3. Check your work</p>
<p>If you followed the instructions carefully, you have verified that the prior year information in the dev database is unchanged when creating the dev database. Now that we have updated the database, we can check how the dev database has changed by comparing ../q03/dev_q03.txt and dev_q04.txt using diff.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>diff<span class="w"> </span>../q03/dev_v3.txt<span class="w"> </span>dev_v4.txt
</pre></div>
</div>
<p>The diff command will identify the differences between your original dev database and the updated dev database which also contains the 2016 data. So, there will be differences between the two files that are due to the increased number of dealers, owners, agents and 2016 car sales. Verify that these are the only differences you find.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>chen_user@vma50:~/class/a06/q04$ diff ../q03/dev_v3.txt dev_v4.txt
2c2
&lt; 243
---
&gt; 259
4c4
&lt; 34
---
&gt; 36
6c6
&lt; 39
---
&gt; 41
18a19,20
&gt; Sales New 2016:
&gt; 60632
30a33,34
&gt; Sales Used 2016:
&gt; 36296
</pre></div>
</div>
<p>Before proceeding, fix any problems you have found until you are satisfied that your dev database is correct and that your process works flawlessly.</p>
<p>When you have finished this part, answer the following questions:
Enter DONE when you have completed this part.
- How many new agents were added to the dev database?
- How many new owners were added to the dev database?
- How many new dealers were added to the dev database?
- How many new car sales were added for 2016?
- How many used cars sales were added for 2016?</p>
<p>Use check04.sh to check your results.</p>
</div>
</div>
<div class="admonition-part-5-updating-the-operational-database admonition">
<p class="admonition-title">Part 5. Updating the Operational Database</p>
<p>Navigate to q05. Once you are sure you have updated the dev database properly with the 2016 data, you will run the insert.sh again. This time we will specify the sales database (this will create a file called update_sales2016.sql). We will then use the generated update_sales2016.sql to insert the 2016 sales data to the sales database. The overall procedure is as follows:</p>
<ul class="simple">
<li><p>Create soft (symbolic) links: Start by creating a soft link to q04/insert.sh and q04/mysql in your q05 directory.</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ln<span class="w"> </span>-s<span class="w"> </span>../q04/insert.sh
ln<span class="w"> </span>-s<span class="w"> </span>../q04/mysql
</pre></div>
</div>
<ul class="simple">
<li><p>Update sales database: Run insert.sh again, this time for the sales database. This will update the sales database. (Note: this will take some time)</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./insert.sh<span class="w"> </span>sales<span class="w"> </span><span class="m">2016</span>
mysql<span class="w"> </span>–u<span class="w"> </span><span class="nv">$MYSQLU</span><span class="w"> </span>–p<span class="nv">$MYSQLP</span><span class="w"> </span>&lt;<span class="w"> </span>the_sql_file<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p>Use top and SELECT COUNT (repetitively) to monitor the mysql service:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>top
SELECT<span class="w"> </span>COUNT<span class="o">(</span>*<span class="o">)</span><span class="w"> </span>FROM<span class="w"> </span>sales_2016<span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Create the data quality check .sql file: Copy the dev_v4.sql file you created for question 4 to q05 and call it sales_v5.sql. Change the database used in sales_v5.sql to the sales database. Use sales_v5.sql as input to the mysql command and give the output a unique name, sales_v5.txt. This can be done as follows (Note: your figures will not be correct before the data insertion is complete):</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mysql<span class="w"> </span>-u<span class="w"> </span><span class="nv">$MYSQLU</span><span class="w"> </span>-p<span class="nv">$MYSQLP</span><span class="w"> </span>&lt;<span class="w"> </span>input_sql_file<span class="w"> </span>&gt;<span class="w"> </span>output_txt_file
</pre></div>
</div>
<ul class="simple">
<li><p>Use diff to compare the files: sales_v5.txt and ../q04/dev_v4.txt (should be identical); sales_v5.txt and ../q01/sales_v1.txt (should show difference before and after update)</p></li>
</ul>
<p>You can use check05.sh (your figures will be incorrect before the data insertion is complete) to make sure all the required files have been created and that the output files contain the information they should.</p>
<p>When you have finished this part, enter DONE in part A of a05.txt and answer the following questions in parts B through F.
Enter DONE when you have completed this part.
- How many new agents were added to the sales database?
- How many new owners were added to the sales database?
- How many new dealers were added to the sales database?
- How many new car sales were added to the sales database for 2016?
- How many used cars sales were added to the sales database for 2016?</p>
</div>
<div class="admonition-part-6-creating-backups-of-the-initial-upgraded-system admonition">
<p class="admonition-title">Part 6. Creating Backups of the Initial Upgraded System</p>
<p>Navigate to q06.</p>
<p>Finally,
- create an external backup file of the new production database as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mysqldump<span class="w"> </span>–u<span class="w"> </span><span class="nv">$MYSQLU</span><span class="w"> </span>–p<span class="nv">$MYSQLP</span><span class="w"> </span>sales<span class="w"> </span>&gt;<span class="w"> </span>sales_v6.sql
</pre></div>
</div>
<ul class="simple">
<li><p>use gzip to compress the file:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gzip<span class="w"> </span>sales_v6.sql
</pre></div>
</div>
<ul class="simple">
<li><p>copy your backup file (sales_v6.sql.gz) into your ~/backup directory.</p></li>
</ul>
<p>When you have finished Part 6, enter DONE in part A of a06.txt</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="week6.html" class="btn btn-neutral float-left" title="7. Week 6" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../07.week7/week7.html" class="btn btn-neutral float-right" title="8. Week 7" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>